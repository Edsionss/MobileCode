<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>组件面板 - BEM 原型</title>

  <!-- CDN 依赖 (与之前相同) -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vant@2.12/lib/index.css" />
  <script src="https://cdn.jsdelivr.net/npm/vant@2.12/lib/vant.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuedraggable@2.24.3/dist/vuedraggable.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">

  <style>
    /* CSS 已按 BEM 规范重构 */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      padding: 20px;
      background-color: #f7f8fa;
    }

    #app {
      width: 300px;
      border: 1px solid #e4e7ed;
      border-radius: 4px;
      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    /* Block: framework-panel */
    .framework-panel {
      width: 100%;
      height: 100%;
      background-color: #fff;
    }

    /* Element: framework-panel__accordion (顶级手风琴容器) */
    .framework-panel__accordion {
      border-bottom: 1px solid #e4e7ed;
    }

    /* Element: framework-panel__item (每个UI框架项) */
    .framework-panel__item {
      border-top: 1px solid #e4e7ed;
    }

    .framework-panel__item:first-child {
      border-top: none;
    }

    /* Element: framework-panel__header (框架项的头部) */
    .framework-panel__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      cursor: pointer;
      background-color: #fafafa;
      font-weight: 600;
      font-size: 15px;
      transition: background-color 0.2s;
    }

    .framework-panel__header:hover {
      background-color: #f5f5f5;
    }

    /* Element: framework-panel__label, framework-panel__arrow (头部内的元素) */
    .framework-panel__label {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .framework-panel__arrow {
      transition: transform 0.3s;
    }

    /* Modifier: framework-panel__arrow--collapsed (箭头的折叠状态) */
    .framework-panel__arrow--collapsed {
      transform: rotate(-90deg);
    }

    /* Element: framework-panel__content (框架项的内容区域) */
    .framework-panel__content {
      padding: 0 10px 10px 10px;
    }

    /* --- 内部组件分组样式 (依然遵循BEM，但以 'group-list' 为新Block) --- */
    .group-list {
      border-top: 1px solid #f0f0f0;
    }

    .group-list__item {
      border-bottom: 1px solid #f0f0f0;
    }

    .group-list__item:last-child {
      border-bottom: none;
    }

    .group-list__header {
      font-size: 14px;
      color: #606266;
      font-weight: 500;
      cursor: pointer;
      padding: 10px;
      display: flex;
      align-items: center;
    }

    .group-list__label {
      flex: 1;
    }

    .group-list__icon {
      display: flex;
      justify-content: right;
      transition: transform 0.3s;
    }

    .group-list__icon--collapsed {
      transform: rotate(-90deg);
    }

    /* --- 拖拽组件区域样式 (以 'drag-zone' 为新Block) --- */
    .drag-zone {
      padding: 10px 5px;
    }

    .drag-zone__group {
      width: 100%;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .drag-zone__item {
      width: calc(50% - 4px);
      box-sizing: border-box;
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 40px;
      border: 1px solid #e9e9eb;
      border-radius: 4px;
      font-size: 13px;
      color: #303133;
      cursor: move;
      transition: all 0.2s ease-in-out;
      -webkit-user-select: none;
      user-select: none;
    }

    .drag-zone__item:hover {
      border-color: #409EFF;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    /* Modifier: for vuedraggable's chosen class */
    .drag-zone__item--chosen {
      background-color: #e6f7ff !important;
      border: solid 1px #409EFF !important;
    }
  </style>
</head>

<body>

  <div id="app">
    <!-- 根组件，props保持不变 -->
    <framework-panel :components-array="allFrameworks"></framework-panel>
  </div>

  <script>
    // 测试数据源 (保持不变)
    const elementData = { defaultGroup: 'base', componentName: 'ElementUI', group: [{ name: 'base', label: '基础组件', group: [{ label: '表单', name: 'form', children: [{ label: '输入框', tag: 'el-input' }, { label: '计数器', tag: 'el-input-number' }] }, { label: '布局', name: 'layout', children: [{ label: '行', tag: 'el-row' }, { label: '列', tag: 'el-col' }] }] }, { name: 'special', label: '特色组件', group: [] }] };
    const vantData = { defaultGroup: 'base', componentName: 'VantUI', group: [{ name: 'base', label: '基础组件', group: [{ label: '表单', name: 'form', children: [{ label: '输入框', tag: 'van-field' }, { label: '步进器', tag: 'van-stepper' }] }] }, { name: 'special', label: '特色组件', group: [] }] };
    const layuiData = { defaultGroup: 'base', componentName: 'Layui', group: [{ name: 'base', label: '基础组件', group: [] }] };

    // Vue 组件定义
    Vue.component('framework-panel', {
      // template 中的 class 已全部更新为 BEM 规范
      template: `
                <div class="framework-panel">
                    <div class="framework-panel__accordion">
                        <div v-for="framework in componentsArray" :key="framework.componentName" class="framework-panel__item">
                            <div class="framework-panel__header" @click="toggleFramework(framework.componentName)">
                                <span class="framework-panel__label">
                                    <i :class="getFrameworkIcon(framework.componentName)"></i>
                                    {{ framework.componentName }}
                                </span>
                                <i :class="['framework-panel__arrow', 'el-icon-arrow-down', { 'framework-panel__arrow--collapsed': activeFrameworkName !== framework.componentName }]"></i>
                            </div>
                            <div class="framework-panel__content" v-show="activeFrameworkName === framework.componentName">
                                <van-tabs color="#409EFF" v-model="activeTabs[framework.componentName]">
                                    <van-tab v-for="group in framework.group" :title="group.label" :name="group.name" :key="group.name">
                                        <div class="group-list">
                                            <div class="group-list__item" v-for="children in group.group" :key="children.name">
                                                <div class="group-list__header" @click="foldItem(framework.componentName, children.name)">
                                                    <div class="group-list__label">{{ children.label }}</div>
                                                    <i :class="['group-list__icon', 'el-icon-arrow-down', { 'group-list__icon--collapsed': !isGroupOpen(framework.componentName, children.name) }]"></i>
                                                </div>
                                                <div v-show="isGroupOpen(framework.componentName, children.name)">
                                                    <draggable 
                                                        :list="children.children"
                                                        :group="{ name: 'itxst', pull: 'clone', put: false }"
                                                        :force-fallback="true"
                                                        :animation="300"
                                                        :sort="false"
                                                        :clone="item => onClone(item, children, framework)"
                                                        chosen-class="drag-zone__item--chosen"
                                                        class="drag-zone">
                                                        <div class="drag-zone__group">
                                                            <div class="drag-zone__item" v-for="(item, index) in children.children" :key="index">
                                                                {{ item.label }}
                                                            </div>
                                                        </div>
                                                    </draggable>
                                                </div>
                                            </div>
                                        </div>
                                    </van-tab>
                                </van-tabs>
                            </div>
                        </div>
                    </div>
                </div>
            `,
      props: { componentsArray: { type: Array, default: () => [] } },
      // JS 逻辑部分保持不变，因为它与 class 名称无关
      data () { return { activeFrameworkName: '', activeTabs: {}, groupShowStates: {} } },
      created () { this.initComponentsState(); },
      watch: { componentsArray: { handler () { this.initComponentsState(); }, deep: true } },
      methods: {
        generateUniqueId () { return Date.now().toString(36) + Math.random().toString(36).substr(2); },
        initComponentsState () { if (this.componentsArray.length === 0) return; this.activeFrameworkName = this.componentsArray[0].componentName; this.componentsArray.forEach(framework => { this.$set(this.activeTabs, framework.componentName, framework.defaultGroup); if (framework.group) { framework.group.forEach(g => { if (g.group) { g.group.forEach(subG => { const key = `${framework.componentName}-${subG.name}`; this.$set(this.groupShowStates, key, true); }); } }); } }); },
        toggleFramework (frameworkName) { this.activeFrameworkName = this.activeFrameworkName === frameworkName ? '' : frameworkName; },
        foldItem (frameworkName, groupName) { const key = `${frameworkName}-${groupName}`; this.$set(this.groupShowStates, key, !this.groupShowStates[key]); },
        isGroupOpen (frameworkName, groupName) { const key = `${frameworkName}-${groupName}`; return this.groupShowStates[key]; },
        getFrameworkIcon (name) { const icons = { ElementUI: 'el-icon-platform-eleme', VantUI: 'el-icon-mobile-phone', Layui: 'el-icon-monitor' }; return icons[name] || 'el-icon-menu'; },
        onClone (originalItem, parentGroup, framework) { let newItem = _.cloneDeep(originalItem); newItem.id = this.generateUniqueId(); newItem.framework = framework.componentName; newItem.groupName = parentGroup.name; newItem.groupLabel = parentGroup.label; console.log('Cloned new item:', newItem); return newItem; }
      }
    });

    // Vue 根实例
    new Vue({
      el: '#app',
      data: {
        allFrameworks: [elementData, vantData, layuiData]
      }
    });
  </script>

</body>

</html>